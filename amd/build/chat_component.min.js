define("block_ai_chat/chat_component",["exports","core/reactive","core/templates","block_ai_chat/helper"],(function(_exports,_reactive,_templates,helper){var obj;function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_templates=(obj=_templates)&&obj.__esModule?obj:{default:obj},helper=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(helper);class ChatComponent extends _reactive.BaseComponent{create(){this.name="ChatComponent",this.selectors={MESSAGES:"[data-block_ai_chat-element='messages']",PERSONABANNER:"[data-block_ai_chat-element='personabanner']",PERSONA_SELECT_DROPDOWN:"[data-block_ai_chat-element='personaselectdropdown']",INPUT_TEXTAREA:"[data-block_ai_chat-element='inputtextarea']",SUBMIT_BUTTON:"[data-block_ai_chat-element='submitbutton']"}}stateReady(state){console.log(state);const personaDropdownContainer=this.getElement(this.selectors.PERSONA_SELECT_DROPDOWN);this.reactive.state.personas.forEach((persona=>{const optionElement=document.createElement("option");optionElement.value=persona.id,optionElement.text=persona.name,personaDropdownContainer.appendChild(optionElement)}));this.getElement(this.selectors.PERSONABANNER).innerText="".concat(this.reactive.state.personas.get(state.config.currentPersona).userinfo),this.addEventListener(this.getElement(this.selectors.PERSONA_SELECT_DROPDOWN),"change",this._selectCurrentPersonaListener);const textarea=this.getElement(this.selectors.INPUT_TEXTAREA);console.log(textarea);this.getElement(this.selectors.SUBMIT_BUTTON).addEventListener("click",this._submitAiRequestListener.bind(this)),this._refreshPersona({element:state.config})}getWatchers(){return[{watch:"messages:created",handler:this._renderMessageToChatArea},{watch:"config.currentPersona:updated",handler:this._refreshPersona}]}async _renderMessageToChatArea(_ref){let{element:element}=_ref;console.log("MESSAGES WERDEN GERENDERT"),console.log(element);const templateData={id:element.id,senderai:"ai"===element.sender,content:element.content},{html:html,js:js}=await _templates.default.renderForPromise("block_ai_chat/message",templateData);_templates.default.appendNodeContents(".block_ai_chat-output",html,js),helper.attachCopyListenerLast(),helper.scrollToBottom()}_refreshPersona(_ref2){let{element:element}=_ref2;const newPersonaId=element.currentPersona;console.log(newPersonaId),console.log("PERSONA WIRD REFRESHED"),console.log(this.getElement(this.selectors.PERSONABANNER)),this.getElement(this.selectors.PERSONABANNER).innerText="".concat(this.reactive.state.personas.get(newPersonaId).userinfo)}_putPersonaListener(){event.preventDefault(),console.log("Firing the event");this.reactive.dispatch("putPersona",21,{userid:0,name:"new name",prompt:"New prompt",userinfo:"Das ist eine neue persona"})}_selectCurrentPersonaListener(){event.preventDefault(),this.reactive.dispatch("selectCurrentPersona",this.reactive.state.static.contextid,event.target.value)}_submitAiRequestListener(){event.preventDefault();const prompt=this.getElement(this.selectors.INPUT_TEXTAREA).value;this.reactive.dispatch("submitAiRequest",prompt)}}var _default=ChatComponent;return _exports.default=_default,_exports.default}));

//# sourceMappingURL=chat_component.min.js.map