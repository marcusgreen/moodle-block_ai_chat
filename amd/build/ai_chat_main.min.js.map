{"version":3,"file":"ai_chat_main.min.js","sources":["../src/ai_chat_main.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n\nimport {Reactive} from 'core/reactive';\nimport {eventTypes, notifyBlockAiChatStateUpdated} from 'block_ai_chat/events';\nimport ChatComponent from 'block_ai_chat/chat_component';\nimport {mutations} from 'block_ai_chat/mutations';\nimport * as Ajax from 'core/ajax';\n\n\n/**\n * Main module for the reactive frontend of the block_ai_chat.\n *\n * @module     block_ai_chat/ai_chat_main\n * @copyright  2025 ISB Bayern\n * @author     Philipp Memmel\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nexport const init = async (contextid, userid) => {\n    const state = {\n        \"static\": {\n            \"contextid\": 21,\n            \"currentUser\": 40\n        },\n        \"config\": {\n            \"conversationLimit\": 5,\n            \"windowMode\": \"docked\",\n            \"mode\": \"agent\",\n            \"CurrentConversationId\": 0\n        },\n        \"messages\": [],\n        \"personas\": [\n            {\n                \"id\": 13,\n                \"name\": \"Friendly Bot\",\n                \"prompt\": \"You are a friendly and helpful AI assistant.\",\n                \"userinfo\": \"Very friendly chatbot\",\n                \"userid\": 0\n            },\n            {\n                \"id\": 14,\n                \"name\": \"Bad person\",\n                \"prompt\": \"You are a very bad person insulting your conversation partner all the time.\",\n                \"userinfo\": \"Really bad person\",\n                \"userid\": 40\n            }\n        ]\n    };\n    const result = await Ajax.call([{\n        methodname: 'block_ai_chat_get_personas',\n        args: {\n            contextid,\n            userid\n        }\n    }])[0];\n    state.personas = result[0].fields;\n    // TODO: Change this to REAL selected current persona\n    state.config.currentPersona = result[0].fields[0].id;\n    console.log(state);\n\n    const reactiveChat = new Reactive({\n        name: 'block_ai_chat_reactive_chat',\n        eventName: eventTypes.blockAiChatStateUpdated,\n        eventDispatch: notifyBlockAiChatStateUpdated,\n        state,\n    });\n\n    const mainElement = document.querySelector('.modal-dialog.block_ai_chat_reactive_main_component');\n\n    console.log(mainElement);\n\n    new ChatComponent({\n        element: mainElement,\n        reactive: reactiveChat,\n    });\n    reactiveChat.setMutations(mutations);\n\n    const messages = await Ajax.call([{\n        methodname: 'block_ai_chat_get_messages',\n        args: {\n            contextid,\n            userid\n        }\n    }])[0];\n    state.config.currentConversationId = messages[0].conversationid;\n    console.log(messages)\n    reactiveChat.stateManager.processUpdates(messages);\n\n    console.log(state);\n};"],"names":["async","contextid","userid","state","result","Ajax","call","methodname","args","personas","fields","config","currentPersona","id","console","log","reactiveChat","Reactive","name","eventName","eventTypes","blockAiChatStateUpdated","eventDispatch","notifyBlockAiChatStateUpdated","mainElement","document","querySelector","ChatComponent","element","reactive","setMutations","mutations","messages","currentConversationId","conversationid","stateManager","processUpdates"],"mappings":";;;;;;;;mlCA+BoBA,MAAOC,UAAWC,gBAC5BC,MAAQ,QACA,WACO,eACE,WAET,mBACe,aACP,cACN,8BACiB,YAEjB,YACA,CACR,IACU,QACE,sBACE,wDACE,+BACF,GAEd,IACU,QACE,oBACE,uFACE,2BACF,MAIhBC,aAAeC,KAAKC,KAAK,CAAC,CAC5BC,WAAY,6BACZC,KAAM,CACFP,UAAAA,UACAC,OAAAA,WAEJ,GACJC,MAAMM,SAAWL,OAAO,GAAGM,OAE3BP,MAAMQ,OAAOC,eAAiBR,OAAO,GAAGM,OAAO,GAAGG,GAClDC,QAAQC,IAAIZ,aAENa,aAAe,IAAIC,mBAAS,CAC9BC,KAAM,8BACNC,UAAWC,mBAAWC,wBACtBC,cAAeC,sCACfpB,MAAAA,QAGEqB,YAAcC,SAASC,cAAc,uDAE3CZ,QAAQC,IAAIS,iBAERG,wBAAc,CACdC,QAASJ,YACTK,SAAUb,eAEdA,aAAac,aAAaC,4BAEpBC,eAAiB3B,KAAKC,KAAK,CAAC,CAC9BC,WAAY,6BACZC,KAAM,CACFP,UAAAA,UACAC,OAAAA,WAEJ,GACJC,MAAMQ,OAAOsB,sBAAwBD,SAAS,GAAGE,eACjDpB,QAAQC,IAAIiB,UACZhB,aAAamB,aAAaC,eAAeJ,UAEzClB,QAAQC,IAAIZ"}